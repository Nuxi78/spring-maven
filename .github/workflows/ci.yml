  name: Spring Boot CI

  on:
    push:
      branches: [ main ]
    pull_request:
      branches: [ main ]

  jobs:
    build:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout repository
          uses: actions/checkout@v4

        - name: Set up JDK 17
          uses: actions/setup-java@v4
          with:
            java-version: '17'
            distribution: 'temurin'
            cache: maven

        - name: Configure Maven settings
          run: |
            mkdir -p ~/.m2
            cat > ~/.m2/settings.xml <<EOF
            <settings>
              <servers>
                <server>
                  <id>nexus</id>
                  <username>${NEXUS_USER}</username>
                  <password>${NEXUS_PASSWORD}</password>
                </server>
              </servers>
            </settings>
            EOF
          env:
            NEXUS_USER: ${{ secrets.NEXUS_USER }}
            NEXUS_PASSWORD: ${{ secrets.NEXUS_PASSWORD }}

        - name: Build & Deploy to Nexus
          run: mvn clean deploy -DskipTests
